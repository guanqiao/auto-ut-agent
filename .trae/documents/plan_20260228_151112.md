# 添加依赖、增强测试和容错能力方案

## 1. 依赖更新

### 新增依赖项
需要添加以下依赖到 `requirements.txt` 和 `pyproject.toml`：

```
# Aider 集成相关
aider-chat>=0.60.0          # Aider 核心库
gitpython>=3.1.40           # Git 操作支持

# 增强容错和重试
tenacity>=8.2.0             # 高级重试机制
backoff>=2.2.0              # 指数退避重试

# 测试增强
pytest-html>=4.1.0          # HTML 测试报告
pytest-metadata>=3.1.0      # 测试元数据
allure-pytest>=2.13.0       # Allure 测试报告
```

## 2. 测试代码增强

### 创建带 @Display 描述的测试用例
- 使用 pytest 的 `@pytest.mark.description` 或自定义装饰器
- 创建 Java 风格的测试报告（使用 Allure 或 pytest-html）
- 新增 `tests/unit/tools/test_aider_integration.py` 测试 Aider 集成功能

### 测试文件规划
1. **test_aider_integration.py** - Aider 集成测试
2. **增强现有测试** - 添加详细描述和边界测试

## 3. 容错能力增强

### 新增容错模块
1. **error_recovery.py** - 错误恢复策略
2. **retry_manager.py** - 增强重试管理
3. **fallback_strategies.py** - 降级策略

### 容错功能
- 指数退避重试
- 多级降级策略（Aider → 全量生成 → 模板）
- 错误分类和恢复建议
- 超时控制
- 资源清理

## 4. 实施步骤

1. 更新依赖文件
2. 创建带 Display 描述的测试用例
3. 增强容错模块
4. 更新 Aider 集成代码增强容错
5. 运行测试验证

请确认此方案后，我将开始实施。